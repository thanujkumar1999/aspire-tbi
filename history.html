<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Booking History</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { margin: 0; background: #f4f9ff; color: #333; }
    .header { background: #004080; color: white; padding: 16px; font-size: 20px; text-align: center; }
    .tabs { display: flex; justify-content: space-around; background: #e0ecf8; }
    .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; }
    .tab.active { background: #fff; border-bottom: 3px solid #004080; }
    .filter-bar { padding: 10px; background: #f0f0f0; text-align: center; }
    .filter-bar input[type="date"] { padding: 6px; font-size: 14px; }
    .filter-bar button { padding: 6px 10px; font-size: 14px; margin-left: 10px; background: #004080; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .filter-bar button:hover { background: #003060; }
    .content { padding: 15px; }
    .booking-card { background: #fff; margin-bottom: 10px; border-radius: 10px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .booking-card h4 { margin: 0 0 5px; color: #004080; }
    .booking-card p { margin: 4px 0; font-size: 14px; }
    .empty { text-align: center; margin-top: 20px; color: #888; }
  </style>
</head>
<body>
  <div class="header">Booking History</div>

  <div class="tabs">
    <div class="tab" id="tabInstrument">Instrument</div>
    <div class="tab" id="tabConference">Conference</div>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <label for="dateFilter"><strong>Filter by Date:</strong></label>
    <input type="date" id="dateFilter" />
    <button id="resetFilter">Reset</button>
  </div>

  <div class="content" id="instrumentTab"></div>
  <div class="content" id="conferenceTab" style="display: none;"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAlZZ79I_UCaTwV4KHo67Rauv99epa_VHc",
      authDomain: "aspire-tbi.firebaseapp.com",
      projectId: "aspire-tbi",
      storageBucket: "aspire-tbi.appspot.com",
      messagingSenderId: "9906395381",
      appId: "1:9906395381:web:546de5f0f6234703144dbc"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tabInstrument = document.getElementById("tabInstrument");
    const tabConference = document.getElementById("tabConference");
    const instrumentTab = document.getElementById("instrumentTab");
    const conferenceTab = document.getElementById("conferenceTab");
    const dateFilter = document.getElementById("dateFilter");
    const resetFilter = document.getElementById("resetFilter");

    function activateTab(tabName) {
      if (tabName === "instrument") {
        tabInstrument.classList.add("active");
        tabConference.classList.remove("active");
        instrumentTab.style.display = "block";
        conferenceTab.style.display = "none";
      } else {
        tabConference.classList.add("active");
        tabInstrument.classList.remove("active");
        conferenceTab.style.display = "block";
        instrumentTab.style.display = "none";
      }
    }

    tabInstrument.addEventListener("click", () => {
      activateTab("instrument");
    });
    tabConference.addEventListener("click", () => {
      activateTab("conference");
    });

    function createBookingCard(type, data) {
      const card = document.createElement("div");
      card.classList.add("booking-card");
      const title = (type === "instrument") ? (data.instrument || "Instrument") : (data.room || "Conference");
      let html = `<h4>${title}</h4>`;
      html += `<p><strong>Date:</strong> ${data.date || "-"}</p>`;
      html += `<p><strong>Time:</strong> ${data.slot || "-"}</p>`;
      html += `<p><strong>Purpose:</strong> ${data.purpose || "-"}</p>`;
      html += `<p><strong>Booking ID:</strong> ${data.bookingId || "-"}</p>`;
      card.innerHTML = html;
      return card;
    }

    async function loadHistory(selectedDate = null) {
      // Instrument Bookings
      const instrDocs = await getDocs(collection(db, "bookings"));
      instrumentTab.innerHTML = "";
      let hasInstrumentData = false;

      instrDocs.forEach(doc => {
        const data = doc.data();
        if (!selectedDate || data.date === selectedDate) {
          instrumentTab.appendChild(createBookingCard("instrument", data));
          hasInstrumentData = true;
        }
      });

      if (!hasInstrumentData) {
        instrumentTab.innerHTML = `<div class="empty">No instrument bookings found${selectedDate ? " on selected date." : "."}</div>`;
      }

      // Conference Bookings
      const confDocs = await getDocs(collection(db, "conference_bookings"));
      conferenceTab.innerHTML = "";
      let hasConferenceData = false;

      confDocs.forEach(doc => {
        const data = doc.data();
        if (!selectedDate || data.date === selectedDate) {
          conferenceTab.appendChild(createBookingCard("conference", data));
          hasConferenceData = true;
        }
      });

      if (!hasConferenceData) {
        conferenceTab.innerHTML = `<div class="empty">No conference bookings found${selectedDate ? " on selected date." : "."}</div>`;
      }
    }

    // Event listeners
    dateFilter.addEventListener("change", () => {
      const selectedDate = dateFilter.value;
      if (selectedDate) {
        loadHistory(selectedDate);
      }
    });

    resetFilter.addEventListener("click", () => {
      dateFilter.value = "";
      loadHistory(); // Reload all data
    });

    // Initial setup
    activateTab("instrument");
    loadHistory();
  </script>
</body>
</html>
